在这个视频中，我们将讨论如何\N训练这个U-Net神经网络并让它预测噪声。 我们的目标是让网络预测噪声，\N真正的任务是让它学习图像上的噪声分布， 但也要学习什么不是噪声，\N像是游戏角色的特征。 我们的做法是从训练数据中\N取一个游戏角色，然后给它加噪声。 我们给它加噪声，然后\N让神经网络预测这个噪声。 然后我们将预测的噪声\N与实际添加到图像上的噪声进行比较。 这就是我们计算损失的方式。 然后通过反向传播\N让神经网络学会更好地预测噪声。 那么如何确定这里的噪声是什么呢？ 你可以通过时间和采样，\N给它不同的噪声级别。 但在实际训练中，我们不希望\N神经网络一直观察同一个游戏角色图像。 如果在一个周期内观察不同的\N游戏角色图像，它会更稳定，更均匀。 所以我们实际上是\N随机采样一个可能的时间步长， 然后获取相应的噪声级别， 添加到图像中，再让神经网络预测。 然后我们取下一个\N训练数据中的游戏角色图像。 再次随机采样一个时间步长， 它可能完全不同，就像你在这里看到的。 然后我们把它加到这个游戏角色图像上，\N再次让神经网络预测添加的噪声。 这样就得到了一个更稳定的训练方案。 那么训练实际上是什么样子？ 这是一个巫师帽子图像。 这是一个添加了噪声的输入图像。 当你刚把它放入神经网络时，\N神经网络还没有真正学会什么是图像。 所以预测的噪声并没有改变输入的样子。 当它被减去时，\N实际上就变成了这个，看起来差不多。 但到了第31轮时，\N神经网络对这个图像有了更好的理解。 然后它预测的噪声就能从这个输入中\N减去，产生一个看起来像这个巫师帽的图像。 酷，这是一个样本。 这是多个不同样本，\N多个不同图像经过多轮训练的样子。 如你所见，在第一轮训练中，这些模型\N与我们的目标（游戏角色）还相距甚远。 但是，到了第32轮，\N你会发现这些模型已经很像小游戏角色了，\N即便在那之前，其实也已经有了一些形状。 好的，现在我们\N通过一些代码来了解训练算法。 首先，你需要选择一个训练图像。 这里我们将所有数据加载到数据加载器中， 然后将其放入一个进度条，\N以便我们可以看到它的变化。 你可以将这里想象成所有的数据。 然后我们逐个处理所有的数据样本， x 在这里表示一个训练图片。 现在我们来看看 x。 在这个循环中，我们会选择一个时间步长 T， 它决定了噪声的级别。 我们不会遍历所有时间步长，\N只采样一个时间步长 T。 我们产生一个噪音， 然后根据时间步长将这个噪音加到图片上， 然后我们将这个加入了\N噪音的图片输入到神经网络中。 我们还输入时间步长，\N因为我们也要将时间嵌入进去。 然后神经网络预测噪音的输出。 通过比较预测的噪音\N和我们实际加入的噪音，我们可以使用\N均方误差（MSE）计算损失。 然后我们所要做的就是反向传播并学习。 这样，模型就会学习\N什么是噪音，什么是游戏角色了。 好的，接下来我们来看\N我们训练用的 Notebook。 这些都是之前的内容，\N只需按 Shift+Enter 键进行设置即可。 这里的训练超参数\N比较有趣，我们的批次大小是100， 我们将进行32个轮次的训练，\N还有我们的学习速率。 我将按 Shift + Enter 键来运行它。 这里的设置模型和噪音计划与之前相似。 现在开始训练。 你可以加载你的数据集，\N我们将它加载到数据加载器中。 这是一个16x16的游戏角色数据集。 我们也加载了优化器。 这里有一个函数，\N它会扰乱我们的输入， 意思是它会根据特定的时间步长\N向图像添加适当级别的噪音，并返回图像。 我可以在这里按 Shift + Enter 键。 由于在 CPU 上进行训练需要很多小时，\N因此我们在这里实际上不会逐步进行训练， 这也是这些 Notebook 托管的位置。 但我非常建议你走一遍这个过程。 这就是我们刚刚一起看过的那段代码。 但我们可以做的是，我们确实训练了这个\N模型，并在不同的训练轮次中保存了模型， 这样你就可以运行采样，并能够\N看到它在每个训练轮次中的表现。 这是你之前看到的相同的采样代码。 我会快速过一下。 这里是你加载第零轮次的模型的地方。 这是模型检查点\N的路径，第零轮次的模型。 我要加载这个模型。 然后你可以直接可视化这些样本。 再次运行之前相同的采样方法，\N这个方法在上一个视频中有讲解，叫做DDPM。 这需要几分钟，\N我们将在视频中加快这个过程。 非常好！ 我们可以在这里点击播放。 虽然还有点不清晰，\N但已经开始理解游戏角色的大致轮廓。 它并不是纯粹的噪音。 我们也有第四轮的模型让你参考。 你可以看到模型在改进， 这些看起来更像游戏角色了。 接下来是第八轮。 再进一步， 你可以看到里面有些书。 最后，这是第31轮， 或者当我们从零开始计数时，\N可能实际上是第32轮。 这些看起来更像游戏角色图像了。 你可以看到这里有一把剑。 这可能是巫师帽。 这里有个药水。 但当然，这里还有一些斑点，一些人物。 它还不够完美，还可以继续优化。 在下一个视频中，\N你将可以控制你生成的内容，\N也就是你可以指定它生成物体或者这些人物。